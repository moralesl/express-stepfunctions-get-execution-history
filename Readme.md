# Express Step Functions - Get Execution History

This project provides a Python script to retrieve execution history for AWS Step Functions Express Workflows. It addresses the limitation of the `get_execution_history` CLI command not being available for Express Workflows by querying CloudWatch Logs Insights.

## Warning

This script relies on CloudWatch Logs Insights queries, which incur costs based on the amount of log data scanned. Users should be cautious and specify appropriate start and end times to minimize unnecessary log scanning and associated costs.

## Prerequisites

- Python 3.x
- AWS CLI configured with appropriate permissions

## Installation

1. Clone this repository:
```
git clone https://github.com/moralesl/express-stepfunctions-get-execution-history.git
cd express-stepfunctions-get-execution-history
```

2. Install the required Python packages (boto3):
```
pip install -r requirements.txt
```

## Usage

Run the script with the following command:

```
python get-express-execution-history.py --execution-arn <EXECUTION_ARN> --log-group-name <LOG_GROUP_NAME> --start-time <START_TIME> --end-time <END_TIME>
```

### Parameters:

- `--execution-arn`: (Required) The ARN of the Express Workflow execution.
- `--log-group-name`: (Required) The name of the CloudWatch Logs group containing the execution logs.
- `--start-time`: (Optional) The start time for log querying in Unix timestamp seconds format. Default is 1 hour before the current time.
- `--end-time`: (Optional) The end time for log querying in Unix timestamp seconds format. Default is the current time.

### Example:

```
python get-express-execution-history.py --execution-arn arn:aws:states:eu-central-1:123456789012:express:RiderStateTransitionManagement-CDK:795d2a74-7b5b-4f3d-80fb-450625b22f57:c7230d5a-1d7f-47b5-95c6-61f1be03086b --log-group-name StateManagementDemoStack-RiderStateTransitionManagementCDKLogGroup7161A72D-hVcxzezJaHFU --start-time 1731256404 --end-time 1733256404
```

## Output

The script generates a JSON file named `output-express-history.json` in the current directory. This file contains the execution history in a format similar to the output of the `get_execution_history` CLI command for standard Step Functions.

## How It Works

1. The script queries CloudWatch Logs Insights using the provided execution ARN and time range.
2. It processes the log entries and converts them into a format resembling the standard Step Functions execution history.
3. The converted history is then saved to a JSON file.


## Sample Output

In the `examples` directory, you'll find two JSON files that demonstrate the output format of this script compared to the standard Step Functions execution history:

1. `output-standard.json`: This file contains the output of the `get_execution_history` CLI command for a standard workflow execution. It's based on the [Rider State Management Demo](https://github.com/moralesl/rider-state-management-demo) project.

2. `express-history-output.json`: This file shows the output generated by this script for the same workflow executed as an Express workflow.

These samples allow you to compare the structure and content of the execution history between standard and Express workflows, and verify that this script produces output similar to the standard get_execution_history command.


## Limitations

- The script may not capture all event types that are available in standard Step Functions.
- The accuracy and completeness of the execution history depend on the logging configuration of your Express Workflow.

## Contributing

Contributions to improve the script or extend its functionality are welcome. Please submit pull requests or open issues on the GitHub repository.

## License

[MIT License](LICENSE)